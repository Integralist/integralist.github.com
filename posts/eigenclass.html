<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, minimal-ui">
        <title>Ruby&#39;s Eigenclass</title>
        <link rel="stylesheet" href="../styles/github-markdown.css">
        <link rel="stylesheet" href="../styles/prism-default.css">
        <style>
            body {
                min-width: 200px;
                max-width: 790px;
                margin: 0 auto;
                padding: 30px;
            }

            pre[class*="language-"] {
              border: 1px dashed #AAA;
              margin-bottom: 1em;
            }
        </style>
    </head>
    <body>
        <article class="markdown-body">

<h1>Ruby&#39;s Eigenclass</h1>

<ul>
<li><a href="#1">Introduction</a></li>
<li><a href="#2">Singleton and Class method visibility</a></li>
<li><a href="#3">Meta Programming Version</a></li>
</ul>

<div id="1"></div>

<h2>Introduction</h2>

<p>In Ruby, there are three types of methods that can be applied to a class:</p>

<ol>
<li>Instance methods</li>
<li>Singleton methods</li>
<li>Class methods</li>
</ol>

<p>The first are available to all &quot;instances&quot; that are created from the class; the second are only available to a specific instance of a class and finally, the last are only available to the class itself.</p>

<p>Let&#39;s see an example of each:</p>

<pre><code class="language-ruby"># Instance methods

class Foo
  def speak
    puts &quot;hello&quot;
  end
end

foo = Foo.new
bar = Foo.new

foo.speak # =&gt; hello
bar.speak # =&gt; hello

# Singleton methods

class Foo; end

foo = Foo.new
bar = Foo.new

def foo.speak
  puts &quot;hello&quot;
end

foo.speak # =&gt; hello
bar.speak # =&gt; NoMethodError: undefined method `speak&#39; for #&lt;Foo:0x007f97b60c1890&gt;

# Class methods

class Foo
  def self.speak
    puts &quot;hello&quot;
  end
end

foo = Foo.new

foo.speak # =&gt; NoMethodError: undefined method `speak&#39; for #&lt;Foo:0x007f97b3af0fa8&gt;

Foo.speak # =&gt; hello
</code></pre>

<p>The above code (both singleton methods and class methods) demonstrates what is known in the Ruby community as an &quot;Eigenclass&quot;. This is effectively an anonymous class that Ruby creates and inserts into the inheritance hierarchy to hold the class methods (thus not interfering with the instances that are created from the class).</p>

<p>Another way of accessing an Eigenclass is with the following syntax (<code>class &lt;&lt;</code>):</p>

<pre><code class="language-ruby"># Singleton methods

class Foo; end

foo = Foo.new

class &lt;&lt; foo
  def speak
    puts &quot;hello&quot;
  end
end

foo.speak # =&gt; hello

# Class methods

class Foo
  class &lt;&lt; self
    def speak
      puts &quot;hello&quot;
    end
  end
end

Foo.speak # =&gt; hello
</code></pre>

<div id="2"></div>

<h2>Singleton and Class method visibility</h2>

<p>The reason understanding the Eigenclass is important is because it helps to clarify how to make some methods private when they otherwise would seem impossible to make private.</p>

<p>Let&#39;s see an example of what I&#39;m referring to:</p>

<pre><code class="language-ruby">class Foo
  def self.bar
    p &quot;im public&quot;
  end

  private
  def self.baz
    p &quot;im private&quot;
  end
end

Foo.bar # =&gt; im public
Foo.baz # =&gt; im private
</code></pre>

<p>Notice that although we&#39;ve specified <code>def self.baz</code> to be <code>private</code> it is still accessible directly. This is because <code>private</code> only applies to instance methods; and although Singleton/Class methods are instance methods (of the Eigenclass!), in the above example the <code>private</code> method actually applies to the <code>Foo</code> class and not the Eigenclass, and so the class level methods aren&#39;t affected by the <code>private</code> method.</p>

<blockquote>
<p>Note: <code>private</code> is a method and not a directive or special syntax.</p>
</blockquote>

<p>Now that we&#39;ve seen the problem, let&#39;s see how to fix this by taking advantage of the Eigenclass:</p>

<pre><code class="language-ruby"># Singleton method example

class Foo; end

foo = Foo.new

class &lt;&lt; foo
  def speak
    implementation_details
  end

  private

  def implementation_details
    puts &quot;hello!!!&quot;
  end
end

foo.speak # =&gt; hello!!!
foo.implementation_details # =&gt; NoMethodError: private method `implementation_details&#39; called for #&lt;Foo:0x007f97b43f3920&gt;

# Class method example

class Foo
  class &lt;&lt; self
      def speak
        implementation_details
      end

      private

      def implementation_details
        puts &quot;hello!!!&quot;
      end
  end
end

Foo.speak # =&gt; hello!!!
Foo.implementation_details # =&gt; NoMethodError: private method `implementation_details&#39; called for Foo:Class
</code></pre>

<p>In the above code we&#39;re demonstrating how to make some methods public (i.e. <code>speak</code>) while keeping other implementation specific functions private (these types of methods we don&#39;t want to be public as there is no reason for an end user to call the method directly).</p>

<p>In the above code the <code>private</code> method (for both Singleton and Class method examples) goes through the Eigenclass, and as the class methods are technically instance methods on the Eigenclass, so the <code>private</code> directive is enforced.</p>

<div id="3"></div>

<h2>Meta Programming Version</h2>

<blockquote>
<p>Note: thanks to <a href="https://twitter.com/peterc">Peter Cooper</a> for the following tip</p>
</blockquote>

<p>We can utilise a little Ruby meta programming to achieve the same result:</p>

<pre><code class="language-ruby">class Foo
  def self.bar
    p &quot;im public&quot;
  end

  def self.baz
    p &quot;im private&quot;
  end

  private_class_method :baz
end

Foo.bar # =&gt; im public
Foo.baz # =&gt; NoMethodError: private method `baz&#39; called for Foo:Class
</code></pre>

            <hr>
            <h2>Links</h2>
            <ul>
                <li><a href="../index.html">Home</a></li>
                <li><a href="../posts/about.html">About Me</a></li>
                <li><a href="https://github.com/integralist">GitHub</a></li>
                <li><a href="https://twitter.com/integralist">Twitter</a></li>
                <li><a href="http://www.integralist.co.uk/Resume">Resume</a></li>
            </ul>
        </article>
        <script src="../scripts/prism.js"></script>
        <script>
            var _gaq=[['_setAccount','UA-33159515-1'],['_trackPageview']];
            (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
            g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
            s.parentNode.insertBefore(g,s)}(document,'script'));
        </script>
    </body>
</html>
